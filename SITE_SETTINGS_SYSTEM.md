# Система настроек сайта

## Обзор

Система настроек сайта позволяет администратору изменять основные параметры отображения сайта, такие как:

- Название сайта (отображается во вкладке браузера)
- Иконка сайта (favicon)
- Информация в футере

## Архитектура

### Компоненты системы

1. **Админ-панель** (`/admin/settings`) - интерфейс для изменения настроек
2. **Сервис** (`src/services/general-settings-service.ts`) - бизнес-логика работы с настройками
3. **API маршрут** (`/api/general-settings/route.ts`) - REST API для получения и обновления настроек
4. **Layout** (`app/layout.tsx`) - серверная генерация метаданных для отображения в браузере
5. **Footer** (`src/components/FooterWrapper.tsx`) - отображение информации в футере

### Кэширование

Система использует многоуровневое кэширование:

1. **Глобальный кэш** - хранится в `global.generalSettingsCache` и используется всеми компонентами
2. **Клиентский кэш** - хранится в `localStorage` в компоненте `FooterWrapper`

### Инвалидация кэша

Кэш инвалидируется при:

- Обновлении настроек через админ-панель
- Создании начальных настроек
- Любом изменении в таблице `general_settings`

## Как работает обновление метаданных

1. При изменении настроек в админ-панели вызывается API маршрут `/api/general-settings` с методом PUT
2. После успешного обновления в базе данных кэш инвалидируется
3. При следующем запросе страницы сервер получает актуальные настройки из базы данных
4. Функция `generateMetadata` в `layout.tsx` использует актуальные настройки для генерации метаданных
5. Браузер отображает правильное название и иконку сайта во вкладке

## Таблица в базе данных

Таблица `general_settings` содержит следующие поля:

- `id` - UUID, первичный ключ
- `site_title` - текстовое название сайта
- `site_icon` - URL иконки сайта
- `site_footer_info` - информация для отображения в футере
- `created_at` - дата создания
- `updated_at` - дата последнего обновления

## Возможные проблемы и решения

### Проблема: Изменения не отображаются во вкладке браузера

**Возможные причины:**
1. Кэш не был очищен после обновления
2. Ошибка подключения к базе данных
3. Неправильные настройки Supabase

**Решения:**
1. Убедитесь, что кэш инвалидируется при обновлении
2. Проверьте логи сервера на наличие ошибок
3. Проверьте настройки подключения к Supabase

### Проблема: Мерцающие значения при загрузке страницы

**Возможные причины:**
1. Конфликт между серверными и клиентскими метаданными
2. Несинхронизированные кэши

**Решения:**
1. Убедитесь, что используется только серверная генерация метаданных
2. Проверьте, что все компоненты используют один и тот же кэш