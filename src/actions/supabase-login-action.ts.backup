'use server';

import { cookies } from 'next/headers';
import { redirect } from 'next/navigation';
import { createClient } from '@/lib/supabase-server';

export async function supabaseLoginAction(formData: FormData, shouldRedirect: boolean = true) {
  const email = formData.get('email') as string;
  const password = formData.get('password') as string;

  const supabase = await createClient();

  const { error } = await supabase.auth.signInWithPassword({
    email,
    password,
  });

  if (error) {
    console.error('Ошибка при аутентификации через Supabase:', error);
    return { error: 'Неверные учетные данные' };
  }

  // При успешной аутентификации токены будут автоматически сохранены в куки
  // благодаря настройкам Supabase клиента

  // Выполняем редирект на админ панель, если это необходимо
  if (shouldRedirect) {
    redirect('/admin');
  }

  return { success: true };
}