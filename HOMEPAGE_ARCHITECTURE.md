# Новая архитектура главной страницы

## Обзор

Новая архитектура главной страницы позволяет гибко управлять структурой и содержимым главной страницы через админ-панель. Она основана на концепции динамических блоков, которые могут быть настраиваемыми и переставляемыми.

## Архитектура

### Компоненты системы

1. **Таблицы в базе данных**:
   - `homepage_blocks` - хранит информацию о блоках главной страницы

2. **Серверные компоненты**:
   - `DynamicHomepage.tsx` - основной компонент для отображения главной страницы
   - `HomepageBlockWrapper.tsx` - обертка для отдельных блоков
   - Сервисы для работы с данными главной страницы

3. **Клиентские компоненты**:
   - `HomepageEditor.tsx` - визуальный редактор главной страницы
   - Компоненты для каждого типа блока

4. **API маршруты**:
   - `/api/homepage-structure` - получение структуры главной страницы
   - `/api/admin/homepage-blocks` - управление блоками

## Типы блоков

### Существующие типы:
- `categories_grid` - сетка категорий
- `banner_slider` - слайдер баннеров
- `homepage_sections` - разделы с товарами
- `custom_content` - пользовательский контент с заголовком, текстом и изображением


## Настройки блоков

Каждый блок может иметь собственные настройки, хранящиеся в поле `settings` (JSONB):

### Пример настроек для разных типов:
- `categories_grid`: `{ "title": "Название для сетки категорий", "max_display_count": 16 }` - настройки можно задать через интерфейс редактора
- `banner_slider`: `{ "selected_group_ids": ["group-id-1", "group-id-2"], "auto_rotate": true, "rotation_interval": 5000, "show_indicators": true, "show_navigation": true }` - настройки можно задать через интерфейс редактора
- `homepage_sections`: `{ "selected_section_ids": ["section-id-1", "section-id-2"], "display_style": "grid", "columns": 4, "show_prices": true, "show_descriptions": false }` - настройки можно задать через интерфейс редактора
- `custom_content`: `{ "title": "Заголовок пользовательского контента", "text": "Текстовое содержимое", "image_url": "https://res.cloudinary.com/..." }` - настройки можно задать через интерфейс редактора

## Макеты

Система поддерживает несколько макетов главной страницы:
- Один макет может быть установлен как "по умолчанию"
- Администратор может создавать и переключаться между различными макетами
- Макеты могут отличаться набором блоков и их настройками

## Безопасность

- Политики RLS обеспечивают безопасный доступ к данным
- Только администраторы могут изменять структуру и настройки
- Публичные данные (структура главной страницы) доступны для чтения всем пользователям

## Кэширование

- Структура главной страницы кэшируется на сервере
- При изменении блоков или макетов кэш инвалидируется
- Используется многоуровневое кэширование для оптимизации производительности

## Миграция данных

При переходе на новую архитектуру:
- Существующие настройки преобразуются в новую структуру
- Создается макет по умолчанию с блоками на основе текущей структуры
- Обеспечивается обратная совместимость на время перехода