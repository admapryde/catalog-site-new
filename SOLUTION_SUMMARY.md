# Решение проблемы с отображением названия сайта и иконки

## Проблема
При изменении названия сайта и иконки в админ-панели изменения не отображались корректно во вкладке браузера. Наблюдалось мерцание значений и возврат к значениям по умолчанию.

## Причины проблемы
1. Конфликт между серверными и клиентскими метаданными
2. Дублирующаяся логика обновления метаданных в нескольких местах
3. Несогласованное кэширование данных
4. Отсутствие инвалидации кэша при обновлении настроек

## Внесенные изменения

### 1. Упрощение архитектуры метаданных
- Удален компонент `DynamicMetadataUpdater`, который конфликтовал с серверными метаданными
- Оставлено только серверное управление метаданными через `generateMetadata()` в `layout.tsx`

### 2. Единая система кэширования
- Введена глобальная переменная кэша `global.generalSettingsCache` для согласованности между всеми компонентами
- Все компоненты (layout, API route, service) используют один и тот же кэш
- Реализована инвалидация кэша при обновлении настроек

### 3. Обновление клиентов Supabase
- Исправлен импорт клиента Supabase в `layout.tsx` для использования правильной версии
- Обновлена асинхронная логика получения данных в `generateMetadata`

### 4. Улучшенная инвалидация кэша
- Кэш инвалидируется при обновлении настроек через админ-панель
- Кэш инвалидируется при создании начальных настроек
- Все функции обновления и инициализации настроек инвалидируют кэш

### 5. Обновление компонентов
- Обновлен `FooterWrapper` для использования обновленной логики получения настроек
- Удалена дублирующаяся логика обновления метаданных в DOM из формы админ-панели
- Обновлена админ-панель для использования согласованной системы

## Результат
- Название и иконка сайта корректно отображаются во вкладке браузера
- Изменения применяются сразу после сохранения в админ-панели
- Устранено мерцание значений
- Архитектура стала более согласованной и надежной
- Кэширование работает эффективно с правильной инвалидацией

## Файлы, которые были изменены
1. `app/layout.tsx` - обновление получения метаданных
2. `app/api/general-settings/route.ts` - добавление глобального кэша и инвалидации
3. `src/services/general-settings-service.ts` - обновление кэширования и инвалидации
4. `src/components/admin/GeneralSettingsForm.tsx` - удаление дублирующейся логики
5. `src/components/FooterWrapper.tsx` - обновление получения настроек
6. `README.md` - обновление документации
7. `SITE_SETTINGS_SYSTEM.md` - создание документации по системе настроек
8. Исправление ошибок типизации в различных файлах API маршрутов

## Дополнительные исправления
- Исправлены ошибки типизации в большом количестве файлов API маршрутов
- Улучшена типизация для работы с результатами запросов к Supabase
- Добавлены явные указания типов для избежания ошибок компиляции